@defer (when table) {
    @if (data$ | async; as data) {
        @if (data && data.length !== 0) {
            {{ data | json }}
            <div class="absolute flex flex-col h-full w-full overflow-auto scrollbar-hide" cdk-scrollable #scrollableContent>
                <table mat-table [dataSource]="dataSource" matSort class="relative w-full">
                    <thead>
                        <ng-container matColumnDef="count" [sticky]="isSticky('count')">
                            <th mat-header-cell *matHeaderCellDef> Nr. </th>
                            <td mat-cell *matCellDef="let element; let i = index">{{ this.paginator!.pageIndex == 0 ? i + 1 : 1 + i + this.paginator!.pageIndex * this.paginator!.pageSize }}</td>
                        </ng-container>
                        @for (column of table.columns; track $index) {
                            <ng-container matColumnDef="{{ column.name }}" [sticky]="isSticky(column.name)">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="!column.sortable" [ngClass]="{'hidden': column.hidden, 'text-sm': column.textsize == 'sm'}"> {{ column.header }} </th>
                                <td mat-cell *matCellDef="let element" [ngClass]="{'hidden': column.hidden}">
                                    @switch (true) {
                                        @case (column.type == 'checkbox') {
                                            <input type="checkbox" [checked]="element[column.cell]" [disabled]="column.disabled">
                                        }
                                        @default {
                                            @if (column.pipe) {
                                                {{ element[column.cell] | dynamicPipe: column.pipe.name: column.pipe.args }}
                                            } 
                                            @else {
                                                {{ element[column.cell] }}
                                            }                                            
                                        }
                                    }
                                    <!-- <ng-container [ngSwitch]="true"> -->
                                        <!-- <ng-container *ngSwitchCase="column.type == 'checkbox'">
                                            <input type="checkbox" [checked]="element[column.cell]" [disabled]="column.disabled">
                                        </ng-container>
                                        <ng-container *ngSwitchCase="column.type == 'datetime-local'">
                                            <ng-container *ngIf="!column.pipe">{{ element[column.cell] }}</ng-container>
                                            <ng-container *ngIf="column.pipe">{{ element[column.cell] | dynamicPipe: column.pipe.name: column.pipe.args }}</ng-container>
                                        </ng-container>
                                        <ng-container *ngSwitchDefault>
                                            <ng-container *ngIf="!column.pipe">{{ element[column.cell] }}</ng-container>
                                            <ng-container *ngIf="column.pipe">{{ element[column.cell] | dynamicPipe: column.pipe.name: column.pipe.args }}</ng-container>
                                        </ng-container> -->
                                        <!-- <ng-container *ngSwitchCase="!column.type">
                                            <input type="text">
                                        </ng-container> -->
                                        <!-- <editable *ngSwitchCase="!column.type" (update)="updateField(index, column.name)">
                                            <ng-template viewMode>{{ element[column.cell] }}</ng-template>
                                            <ng-template editMode>
                                                <input [formControl]="getControl(index, 'name')" focusable editableOnEnter>
                                            </ng-template>
                                        </editable> -->
                                    <!-- </ng-container> -->
                                </td>
                            </ng-container>
                        }                
                        <tr mat-header-row *matHeaderRowDef="table.columnNames; sticky: true"></tr>
                    </thead>
                    <tr mat-row *matRowDef="let row; columns: table.columnNames;" (click)="show(row.id)"></tr>
                </table>
                @if (table.showPaginator) {
                    <mat-paginator class="sticky bottom-0 z-10" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" (page)="updatePaginator()"></mat-paginator>
                }
            </div>
        } @else {
            <!-- No data state -->
        }
    }
} @placeholder {
    <div class="absolute flex h-12 w-full justify-center inset-0 text-gray-400">
        <div class="flex flex-col items-center text-lg">
            <div class="w-8 h-8 fill-blue-600 text-gray-200 animate-spin">
                <icons class="" name="spinner"></icons>
            </div>
            <span class="mt-2">Tabelle wird vorbereitet...</span>
        </div>
    </div>
} @loading {
    <div class="absolute flex h-12 w-full justify-center inset-0 text-gray-400">
        <div class="flex flex-col items-center text-lg">
            <div class="w-8 h-8 fill-blue-600 text-gray-200 animate-spin">
                <icons class="" name="spinner"></icons>
            </div>
            <span class="mt-2">Daten werden geladen...</span>
        </div>
    </div>
} @error {
    <div class="absolute flex h-12 w-full justify-center inset-0 text-gray-400">
        <div class="flex flex-col items-center text-lg" (click)="retry()">
            <div class="w-8 h-8 mr-2">
                <icons class="stroke-2 stroke-current" name="alert-triangle"></icons>
            </div>
            <span>Es kam zu einem unerwarteten Fehler!</span>
        </div>
    </div>
}